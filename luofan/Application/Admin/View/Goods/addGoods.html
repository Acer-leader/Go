<include file="Public:head"/>
<style>
	.imgnav{
		max-height: 30px;
		overflow: hidden;
		cursor: pointer;
	}
	.imgwrapper{
		display: block;
		width: 78px;
		height: 78px;
		overflow: hidden;
	}
	.imgwrapper img{
		display: block;
		width: 100%;
		padding: 0;
		margin: 0;
		border:0;
	}
	.spanpd10{
		margin:10px;
	}
	.wxtables.wxtables-sku.newtable{
		width: 40%;
		margin: 0;
	}
	.img-list li{
		width: 60px;
		height:60px;
	}
	.cst_h3 span{font-weight: normal;}
	#imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
	.btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
	.file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
	#imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
	#xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
	#xuanze2:hover{ background:#E6E6E6; }
	.huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}

	</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>
<script type="text/javascript" src="__JS__/datepicker/WdatePicker.js"></script>
<div class="container">
  <div class="inner clearfix"> <include file="Public:left"/>
    <!-- end content-left -->

    <div class="content-right fl">
      <h1 class="content-right-title">发布产品</h1>
      <input type="hidden" id="j-isSid" value="0">
      <!-- 是否选择了淘宝类目 -->
      <input type="hidden" id="j-hasNorms" value="1">
      <!-- 淘宝类目下是否有属性 -->
      <input type="hidden" id="supplier" value="">
      <form aciton="{:U('/Admin/Goods/addGoods')}" enctype="multipart/form-data" method="post" id="add_step2" onsubmit="return toVaild()">
        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">基本信息</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>产品分类：</label>
            <div class="form-controls"> 
            	<a href="javascript:void(0)" class="btn btn-primary" id="j-select_category_id"> <i class="gicon-edit white"></i> 选择产品分类 </a>
              <input type="text" value="" id="class_name" style="border: 1px solid #fff;width: 500px;background-color:#fff;" disabled="">
              <input type="hidden" value="" name="cate_id" id="class_id">
              <span class="fi-help-text error"></span> </div>
          </div>

            <!--<div class="formitems">
                <label class="fi-name"><span class="colorRed"></span>所属系列：</label>
                <div class="form-controls">
                    <a href="javascript:void(0)" class="btn btn-primary" id="j-select_series_id"> <i class="gicon-edit white"></i> 选择所属系列 </a>
                    <input type="text" value="" id="series_name" style="border: 1px solid #fff;width: 500px;background-color:#fff;" disabled="">
                    <input type="hidden" value="" name="series_id" id="series_id">
                    <span class="fi-help-text error"></span> </div>
            </div>-->

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>是否上架：</label>
            <div class="form-controls">
              <div class="radio-group">
                <label>
                  <input type="radio" name="is_sale" value="1" >
                  是</label>
                <label>
                  <input type="radio" name="is_sale" value="0" checked>
                  否</label>
              </div>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>是否新品速递：</label>
            <div class="form-controls">
              <div class="radio-group">
                <label>
                  <input type="radio" name="is_new" value="1">
                  是</label>
                <label>
                  <input type="radio" name="is_new" value="0" checked>
                  否</label>
              </div>
            </div>
          </div>


          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>是否猜你喜欢：</label>
            <div class="form-controls">
              <div class="radio-group">
                <label>
                  <input type="radio" name="is_jingxuan" value="1" >
                  是</label>
                <label>
                  <input type="radio" name="is_jingxuan" value="0" checked>
                  否</label>
              </div>
            </div>
          </div>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>是否是热兑商品：</label>
            <div class="form-controls">
              <div class="radio-group">
                <label>
                  <input type="radio" name="is_good" value="1" >
                  是</label>
                <label>
                  <input type="radio" name="is_good" value="0" checked>
                  否</label>
              </div>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>是否热门兑换：</label>
            <div class="form-controls">
              <div class="radio-group">
                <label>
                  <input type="radio" name="is_cuxiao" value="1">
                  是</label>
                <label>
                  <input type="radio" name="is_cuxiao" value="0" checked>
                  否</label>
              </div>
            </div>
          </div>
            <!-- <div class="formitems">
                <label class="fi-name"><span class="colorRed">*</span>限时抢购开始时间：</label>
                <div class="form-controls">
                    <input type="text" class="input" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="starttime"   value=""  >
                </div>
            </div>

            <div class="formitems">
                <label class="fi-name"><span class="colorRed">*</span>限时抢购截止时间：</label>
                <div class="form-controls">
                    <input type="text" class="input"  onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="endtime"    value=""  >
                </div>
            </div> -->

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>排序：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="sort" value="0">
            </div>
          </div>


        </div>





        <!-- end 基本信息 -->

        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">商品信息</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品名称：</label>
            <div class="form-controls">
              <input type="text" class="input xxlarge" name="goods_name" id="goods_name" value="">
              <span class="fi-help-text"></span> </div>
          </div>
         <!-- <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品页标题：</label>
            <div class="form-controls">
              <input type="text" class="input xxlarge" name="goods_title" id="goods_title" style="width:600px" value="">
              <span class="fi-help-text"></span> </div>
          </div>-->

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品简介：</label>
            <div class="form-controls">
              <input type="text" class="input xxlarge" name="goods_des" id="goods_des" style="width:600px" value="">
              <span class="fi-help-text"></span> </div>
          </div>
            <div class="formitems">
                <label class="fi-name"><span class="colorRed">*</span>商品重量：</label>
                <div class="form-controls">
                    <input type="text" class="input mini" name="weight" id="weight"  value="0">KG
                    <span class="fi-help-text"></span> </div>
            </div>


          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>市场价：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="oprice" id="oprice" value="0">
              <span class="fi-help-text"></span> </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>积分价：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="integral" id="integral" value="0">
              <span class="fi-help-text">注：此积分按照(积分/市场价)比例生成,您也可以无视比例自行修改</span> </div>
          </div>
          
          <div class="formitems">
            <label class="fi-name integral_limit"><span class="colorRed">*</span>商品返还积分：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="s_integral" id="s_integral" value="0">
              <span class="fi-help-text">注：此积分按照(积分/返还积分)比例生成,您也可以无视比例自行修改</span> </div>
          </div>
          
          <div class="formitems">
          	<input type="checkbox"  class="start" />开启积分兑换上限
            <label class="fi-name integral_limit"><span class="colorRed"></span>兑换积分上限：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="integral_limit" id="integral_limit" value="0" disabled>
              <span class="fi-help-text"></span> </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>库存：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="store" id="store" value="0">
              <span class="fi-help-text"></span> </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品logo图片：</label>
            <div class="form-controls pdt5 j-imglistPanel">
            	<div class="xuanze_showimge fl mgr10"></div>
                <div class="btnimage fl">选择图片
                    <input type="file"  accept="image/jpg,image/jpeg,image/png" name="serial" id="xuanze" class="file" >
                </div>
                <div class="xuanze_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="xuanze_percent">80%</span></div>
                <span style="color:red;" class="fi-help-text fl lh30 mgl10">建议大小（宽305px高305px）</span>
            </div>
     	    </div>


<!--         <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>产品首页展示图片：</label>
            <div class="form-controls pdt5 j-imglistPanel">
              <div class="baotuan_showimge fl mgr10"></div>
                <div class="btnimage fl">选择图片
                    <input type="file"  accept="image/jpg,image/jpeg,image/png" name="baotuan" id="baotuan" class="file" >
                </div>
                <div class="baotuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="baotuan_percent">80%</span></div>
                <span style="color:red;" class="fi-help-text fl lh30 mgl10">建议大小（宽305px高305px）</span>
            </div>
        </div> -->


          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品切换图片(多选)：</label>
            <div class="form-controls pdt5 j-imglistPanel">
                <div class="btnimage fl">选择图片
                    <input type="file"  accept="image/jpg,image/jpeg,image/png" name="serial" id="duoxuan" class="file" >
                </div>
                <div class="duoxuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="duoxuan_percent">80%</span></div>
                <span style="color:red;" class="fi-help-text fl lh30 mgl10">建议大小（宽305px高305px）</span>
                <div style="clear:both"></div>
                <div class="duoxuan_showimge mgr10"></div>
            </div>
     	  </div>

          
          
		
       
		</div>



        <div class="panel-single panel-single-light mgt20 j-showinhyd" style="display: block;">
            <span style="color:red;float:right;">图片建议大小（宽600px高不限）</span>
          <h3 class="cst_h3 mgb20">详情</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品详情：</label>
            <div class="form-controls">
              <script id="editor" name="detail" type="text/plain" style="width:200px;height:500px;"></script>
            </div>
          </div>
        </div>

        <div class="panel-single panel-single-light mgt20 j-showinhyd" style="display: block;">
          <h3 class="cst_h3 mgb20">产品参数</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>商品参数：</label>
            <div class="form-controls">
              <script id="editor2" name="param" type="text/plain" style="width:200px;height:500px;"></script>
            </div>
          </div>
        </div>

        <!-- end 详情及其它 -->

        <div class="panel-single panel-single-light mgt20 txtCenter">
          <a href="{:U('Admin/Goods/goodsList')}" class="btn">取消</a>
          <input type="submit" class="btn btn-primary" value="保存">
        </div>
      </form>
    </div>
    <!-- end content-right -->
  </div>
</div>
<!-- end container -->

<include file="Public:foot"/>

<div id="albums-overlay" style="display: none;"></div>
<div class="jbox fenlei select-fenlei disshow" >
  <div class="jbox-title">
    <div class="jbox-title-txt">请选择产品分类</div>
    <a href="javascript:void(0);" class="jbox-close cancle"></a></div>
  <div class="jbox-container" style="height: 75px;">
    <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>选择分类：</label>
      <div class="form-controls">
        <select name="select_class_id" id="select_class_id" class="select">
          <foreach name="categorylist" item="vo" >
            <option disabled="" value="">{$vo.classname}</option>
            <foreach name="vo.cate" item="vo1" >
              <option value="{$vo1.id}">&nbsp;&nbsp;&nbsp;|-{$vo1.classname}</option>
            </foreach>
          </foreach>
        </select>
        <span class="fi-help-text"></span> </div>
    </div>
  </div>
  <div class="jbox-buttons"> <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="select_class">确定</a> <a href="javascript:void(0);" class="jbox-buttons-ok btn cancle">取消</a> </div>
</div>

<div id="albums-overlay1" style="display: none;"></div>
<div class="jbox fenlei select-series disshow" >
    <div class="jbox-title">
        <div class="jbox-title-txt">请选择所属系列</div>
        <a href="javascript:void(0);" class="jbox-close cancle"></a></div>
    <div class="jbox-container" style="height: 75px;">
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>选择分类：</label>
            <div class="form-controls">
                <select name="select_series_id" id="select_series_id" class="select">
                    <foreach name="serieslist" item="vo" >
                        <option disabled value="">{$vo.classname}</option>
                        <foreach name="vo.cate" item="vo1" >
                            <option value="{$vo1.id}">&nbsp;&nbsp;&nbsp;|-{$vo1.classname}</option>
                        </foreach>
                    </foreach>
                </select>
                <span class="fi-help-text"></span> </div>
        </div>
    </div>
    <div class="jbox-buttons"> <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="select_series">确定</a> <a href="javascript:void(0);" class="jbox-buttons-ok btn cancle">取消</a> </div>
</div>





<!--选择分类-->
<script type="text/javascript">

		/*var dealer_id = $('#dealers_id').val();
		getstore(dealer_id);
		$('#dealers_id').change(function(){
			dealer_id = $(this).val();
			getstore(dealer_id);
		});*/
	/*function getstore(dealer_id){
		$.ajax({
			url:"{:U('Admin/Goods/ajax_getstore')}",
			type:'post',
			data:{'dealer_id':dealer_id},
			dataType:'json',
			success:function(ret){
				if(ret.result!=0){
					ret = ret.result;
					var str = '';
					console.log(ret);
					for(var val in ret){
						var val = ret[val];
						str += val.storename+' : <input type="text" class="input mini" name="stock[]" value="" >&nbsp;&nbsp;&nbsp;';
						str += '<input type="hidden" class="input mini" name="storeid[]" value="'+val.id+'" >';
					}
					$('#kucun').html(str);
				}
			}
		});
	}*/
 /* $('input[name=buylimit]').click(function(){
    if($(this).val()==3){
      $('input[name=recommend_g]').eq(1).attr('checked','checked');
      $('input[name=recommend_g]').eq(0).attr('disabled','disabled');
    }else{
      $('input[name=recommend_g]').eq(0).removeAttr('disabled','disabled');
    }
  });*/

  $("#j-select_category_id").click(function(){
      $('.select-fenlei').show();
      /*$('#albums-overlay').show();*/
  })
  $(".cancle").click(function(){
      $(this).parent().parent('.jbox').hide();
      /*$('#albums-overlay').hide();*/
  })

  $("#select_class").click(function(){
      var clssid=$("#select_class_id  option:selected").val();
      var classname=$("#select_class_id option:selected" ).text();
     $('#class_id').val(clssid);
     $('#class_name').val(classname);
      $(this).parent().parent('.jbox').hide();
      /*$('#albums-overlay').hide();*/
  })

        $("#j-select_series_id").click(function(){
            $('.select-series').show();
            $('#albums-overlay1').show();
        })
        $(".cancle").click(function(){
            $(this).parent().parent('.jbox').hide();
            $('#albums-overlay1').hide();
        })

        $("#select_series").click(function(){
            var seriesid=$("#select_series_id  option:selected").val();
            var seriesname=$("#select_series_id option:selected" ).text();
            $('#series_id').val(seriesid);
            $('#series_name').val(seriesname);
            $(this).parent().parent('.jbox').hide();
            $('#albums-overlay1').hide();
        })


	UE.getEditor('editor',{
		toolbars: [

      ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']

		],

		autoHeightEnabled: false,
		autoFloatEnabled: true,
		elementPathEnabled:false,
		enableContextMenu:false,
		wordCount:false,

	});

		UE.getEditor('editor2',{
    toolbars: [

      ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']

    ],

    autoHeightEnabled: false,
    autoFloatEnabled: true,
    elementPathEnabled:false,
    enableContextMenu:false,
    wordCount:false,

  });
</script>
<!--选择分类-end->




<!--提交表单前验证-->
<script type="text/javascript">
 $(".start").click(function(){
 	var check = $(".start").attr("checked");
 	if(check==true){
		$("input[name=integral_limit]").removeAttr("disabled");
	}else{
		$("input[name=integral_limit]").attr("disabled","true");
	}
 	
 })







    function toVaild(){

        var classname=$('#class_id').val();
        var goods_name=$('#goods_name').val();
    var goods_des=$('#goods_des').val();
        var goods_ser=$('#goods_ser').val();

		var goods_title=$('#goods_title').val();
        var resource=$('#resource').val();
        var price=$('#price').val();
        var num=$('#j-totalStock').val();
        var upimg=$('#up_img1').val();
        var detail=$('#editor').text();
		var nums=$('#nums').val();

        if(classname==''||classname==null){
            alert('请选择分类');
            return false;
        }
        if(goods_name==''||goods_name==null){
            alert('商品名称必填');
			      $('#goods_name').focus();
            return false;
        }
		
		
		
    if(goods_des==''||goods_des==null){
            alert('产品简介必填');
      $('#goods_des').focus();
            return false;
        }
        
    /*if(goods_title==''||goods_title==null){
            alert('详情产品标题必填');
      $('#goods_title').focus();
            return false;
        }*/
		// if(nums==''||nums==null||nums==0){
  //           alert('请添加规格');
  //           return false;
  //       }
        if(detail==''||detail==null){
            alert('详情必填');
            return false;
        }
        
    }
</script>
<!--提交表单前验证end-->

<!--上传图片-->

<script type="text/javascript" src="__JS__/jquery.js"></script>
<script type="text/javascript" src="__JS__/uploadPreview.min.js"></script>

<script type="text/javascript" src="__JS__/jquery-form.js"></script>


<script>

	$("input[name=oprice]").change(function(){
		var oprice = $(this).val();//市场价
		var integral  =oprice*("{$rate}");
		integral  = Math.floor(integral*100)/100;
		$("input[name=integral]").val(integral);
		var s_integral = Math.floor(integral*("{$tage}")*100)/100;
		$("input[name=s_integral]").val(s_integral);
	})

</script>


<script type="text/javascript">

  function delImg(obj){
    if(!confirm("删除这张图片？")){
      return false;
    }
    var id = $(obj).attr("data-id")
    if(id){
      alert(1);
      return false;
    }
    $(obj).next("input").remove();
    $(obj).remove();
  }
	$(function () {
		var percent = $('.xuanze_percent');
		var progress = $('.xuanze_percent');
		$("#xuanze").wrap("<form id='myupload1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#xuanze").change(function(){ //选择文件
			$("#myupload1").ajaxSubmit({
				dataType:  'json', //数据格式为json
				beforeSend: function() { //开始上传
					progress.show(); //显示进度条
					var percentVal = '0%';
					percent.html(percentVal);
				},
				uploadProgress: function(event, position, total, percentComplete) {
					var percentVal = percentComplete + '%'; //获得进度
					percent.html(percentVal); //显示上传进度百分比
				},
				success: function(data) { //成功
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="logo_pic" id="pic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					$('.xuanze_showimge').html(img);
					progress.hide();
				},
				error:function(xhr){ //上传失败
					//console.log(xhr.status)
				}
			});
		});


		var percent = $('.duoxuan_percent');
		var progress = $('.duoxuan_percent');
		$("#duoxuan").wrap("<form id='myupload' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#duoxuan").change(function(){ //选择文件
			$("#myupload").ajaxSubmit({
				dataType:  'json', //数据格式为json
				beforeSend: function() { //开始上传
					progress.show(); //显示进度条
					var percentVal = '0%';
					percent.html(percentVal);
				},
				uploadProgress: function(event, position, total, percentComplete) {
					var percentVal = percentComplete + '%'; //获得进度
					percent.html(percentVal); //显示上传进度百分比
				},
				success: function(data) { //成功
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80"  class="mgr10 mgt10 " onclick="delImg(this)"><input type="hidden" name="pic1[]" id="pic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					console.log(img);
					$('.duoxuan_showimge').append(img);
					progress.hide();
				},
				error:function(xhr){ //上传失败
					//console.log(xhr.status)
				}
			});
		});

		var percent = $('.baotuan_percent');
    var progress = $('.baotuan_percent');
    $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#baotuan").change(function(){ //选择文件
      $("#baotuan1").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          progress.show(); //显示进度条
          var percentVal = '0%';
          percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="index_pic" id="pic2" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
          $('.baotuan_showimge').html(img);
          progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });

	});
function add_re(r){
	$('#restriction'+r).show();
	}
function del_re(r){
	$('#restriction'+r).hide();
	}
</script>
<!--上传图片-end->










